---
title: "Project 2"
author: "Coco Donovan"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Loading Packages

```{r}
library(readxl)
library(readr)
library(dplyr)
library(Hmisc)
library(mice)
```

### Loading Data

```{r}
tb1 <- read_excel("Copy of Data Columns, Types.xlsx")
tb2 = read_csv('StudentData - TO MODEL.csv')

colnames(tb2) = gsub(" ", "_", colnames(tb2))

tb3 = read_csv('StudentEvaluation- TO PREDICT.csv')

colnames(tb3) = gsub(" ", "_", colnames(tb3))
```

For whatever reason, "StudentData - TO MODEL.xlsx" was being read incorrectly, so I exported the file to csv and read it that way. I chose to read "StudentEvaluation- TOPREDICT.xslx" as a csv for good measure. I did not see a need to export and reread the info file as that file was not impacted. There were ways to specify that certain columns should be read in specific ways; however, the ways in which I tried to specify the columns did not show any improvements.

After running through this process, I realized that NAs were imputed with zeroes, which was not ideal as some there were already zeroes as non-NA values in at least some of the columns. I manually uploaded the data to google sheets and exported through google sheets. This manual process seemed to solve for data quality issues.

### Data Exploration

```{r}
sapply(tb2, is.character)
```

It seems like Brand Code is the only non-numeric value. If the goal is to impute missing values, we could impute missing values using knn (for brand code). I also want to look at what the size of the resulting data set will be if I just apply a remove NA logic.

```{r}
print(nrow(na.omit(tb2)))
```

Removing all NA values leaves us with about 80% of the original data set, which is not so bad until you consider that the prediction data set may have missing NA values and if we end up choosing a variable in the modeling phase with missing NAs in the prediction set, that sets us up for a level of inconsistency. It might just make sense to impute missing values and to do this I will use the mice() function from the mice package. Though before I do this, I want to understand the nature of missingness and the nature of my variables with missing values (most variables).

```{r}
install.packages('visdat')
library(visdat)
vis_miss(tb2)
```

### Imputing Data

```{r}
# Convert factor column to factor (if necessary)
tb2$Brand_Code <- as.factor(tb2$Brand_Code)

# Specify method for each variable type
imputed_data <- mice(data = tb2, m = 1, method = 'pmm', seed = 500)

# Final Imputations
df_train = complete(imputed_data, 1)

test_imputed <- mice(tb3, m = 1, method = imputed_data$method, seed = 500, 
                     predictorMatrix = imputed_data$predictorMatrix, 
                     visitSequence = imputed_data$visitSequence, 
                     form = imputed_data$form)

# Get the completed test data (only one dataset is generated here)
df_test <- complete(test_imputed, 1)

df_test
```


